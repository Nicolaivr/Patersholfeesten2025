<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Festival Schedule</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Barlow Condensed', sans-serif;
    margin: 0;
    background: #fafafa;
  }
  .day-container {
    margin: 20px;
  }
  .day-title {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .schedule {
    display: grid;
    grid-template-columns: 80px 1fr;
    overflow-x: auto;
    position: relative;
    border-top: 1px solid #ccc;
  }
  .times {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    font-size: 0.9em;
    color: #555;
  }
  .stages {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 200px;
    gap: 10px;
    position: relative;
    padding-left: 10px;
  }
  .stage-column {
    position: relative;
    background: #fff;
    border-radius: 5px;
    border: 1px solid #ddd;
  }
  .stage-title {
    background: #333;
    color: #fff;
    text-align: center;
    font-weight: 700;
    padding: 8px 0;
    position: sticky;
    top: 0;
    z-index: 2;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
  }
  .event {
    position: absolute;
    left: 5px;
    right: 5px;
    background: #e63946;
    color: #fff;
    border-radius: 4px;
    padding: 4px;
    font-size: 0.85em;
    box-sizing: border-box;
    cursor: pointer;
    overflow: hidden;
  }
  .tooltip {
    position: absolute;
    background: rgba(0,0,0,0.85);
    color: #fff;
    padding: 6px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    display: none;
    z-index: 100;
    pointer-events: none;
    max-width: 200px;
  }
</style>
</head>
<body>

<div id="container"></div>
<div class="tooltip" id="tooltip"></div>

<script>
async function loadSchedule() {
  const res = await fetch('events.json');
  const events = await res.json();

  const days = {};
  events.forEach(e => {
    if (!days[e.date]) days[e.date] = [];
    days[e.date].push(e);
  });

  const container = document.getElementById('container');
  const tooltip = document.getElementById('tooltip');

  for (const date of Object.keys(days).sort()) {
    const dayEvents = days[date];
    const stages = [...new Set(dayEvents.map(e => e.stage))];

    // Earliest and latest time
    const timesInMinutes = dayEvents.flatMap(e => [toMinutes(e.start), toMinutes(e.end)]);
    const minTime = Math.min(...timesInMinutes);
    const maxTime = Math.max(...timesInMinutes);

    const dayDiv = document.createElement('div');
    dayDiv.className = 'day-container';
    dayDiv.innerHTML = `<div class="day-title">${date}</div>`;

    const scheduleDiv = document.createElement('div');
    scheduleDiv.className = 'schedule';

    // Time column
    const timesCol = document.createElement('div');
    timesCol.className = 'times';
    for (let t = minTime; t <= maxTime; t += 60) {
      const h = Math.floor(t / 60);
      const m = t % 60;
      const label = document.createElement('div');
      label.style.height = '60px';
      label.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
      timesCol.appendChild(label);
    }

    // Stages grid
    const stagesGrid = document.createElement('div');
    stagesGrid.className = 'stages';

    stages.forEach(stage => {
      const stageCol = document.createElement('div');
      stageCol.className = 'stage-column';
      stageCol.innerHTML = `<div class="stage-title">${stage}</div>`;

      const stageEvents = dayEvents.filter(e => e.stage === stage);
      stageEvents.forEach(e => {
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event';
        eventDiv.textContent = e.title;

        const top = (toMinutes(e.start) - minTime);
        const height = Math.max(20, (toMinutes(e.end) - toMinutes(e.start)));
        eventDiv.style.top = `${top}px`;
        eventDiv.style.height = `${height}px`;

        if (e.extra_info) {
          eventDiv.addEventListener('mouseenter', ev => {
            tooltip.style.display = 'block';
            tooltip.textContent = e.extra_info;
          });
          eventDiv.addEventListener('mousemove', ev => {
            tooltip.style.top = ev.pageY + 10 + 'px';
            tooltip.style.left = ev.pageX + 10 + 'px';
          });
          eventDiv.addEventListener('mouseleave', () => {
            tooltip.style.display = 'none';
          });
        }

        stageCol.appendChild(eventDiv);
      });

      stagesGrid.appendChild(stageCol);
    });

    scheduleDiv.appendChild(timesCol);
    scheduleDiv.appendChild(stagesGrid);
    dayDiv.appendChild(scheduleDiv);
    container.appendChild(dayDiv);
  }
}

function toMinutes(timeStr) {
  const [h,m] = timeStr.split(':').map(Number);
  return h*60 + m;
}

loadSchedule();
</script>

</body>
</html>
